---
import CheckCircleIcon from "@/assets/icons/material-symbols--check-circle.svg";
import CancelIcon from "@/assets/icons/material-symbols--cancel.svg";
import { db, Referrers } from "astro:db";
import ToggleAutoApproveButton from "@/components/admin/toggle-auto-approve-button.astro";
import DeleteReferrerButton from "@/components/admin/delete-referrer-button.astro";
import CreateReferrerRow from "@/components/admin/create-referrer-row.astro";
import CopyReferrerLinkButton from "@/components/admin/copy-referrer-link-button.astro";

const referrers = await db.select().from(Referrers);
---

<table data-component="referrer-list">
  <thead>
    <tr>
      <th>Referrer</th>
      <th>Auto-approve</th>
      <th>Default Location</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {
      referrers.map(({ referrer, autoApprove, defaultLocation }) => (
        <tr>
          <td>{referrer}</td>
          <td>
            {autoApprove ? (
              <CheckCircleIcon style="color: lime;" />
            ) : (
              <CancelIcon style="color: red;" />
            )}
          </td>
          <td>
            {defaultLocation}
          </td>
          <td>
            <CopyReferrerLinkButton referrer={referrer} />
            <ToggleAutoApproveButton
              referrer={referrer}
              autoApprove={autoApprove}
            />
            <DeleteReferrerButton referrer={referrer} />
          </td>
        </tr>
      ))
    }
    <CreateReferrerRow />
  </tbody>
</table>

<style is:global>
  table[data-component="referrer-list"] {
    width: 100%;
    border-collapse: collapse;

    & th {
      text-align: center;
      background-color: color-mix(in srgb, var(--color-text) 20%, transparent);
      color: var(--color-text);
    }

    & th,
    & td {
      border: 1px solid var(--color-text);
      padding: 8px;
    }
  }
</style>
